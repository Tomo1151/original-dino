"use strict";console.log("Hello, world!");const e=window.performance&&(performance.now||performance.mozNow||performance.oNow||performance.webkitNow),t=function(e=60){this._fps=e,this._start=this._getTime()};t.prototype._getTime=function(){return e&&e.call(performance)||(new Date).getTime()},t.prototype.onAscFrame=function(){const e=this._getTime();return Math.floor((e-this._start)/(1e3/this._fps))};const i=function(e=0,t=0){this.x=e,this.y=t},n=function(e,t,i){this.width=e,this.height=t,this.position=i,this.width>50&&(this.img=new Image,this.img.src="img/block.png")},o=function(e,t){this.str=e,this.position=t},s={down:new Audio("sound/down.mp3"),jump:new Audio("sound/jump.mp3"),speed:new Audio("sound/speedup.mp3"),score:new Audio("sound/scoreup.mp3")},r=new t(60),c=1,a=-1,l=document.getElementById("fov"),d=document.getElementById("reset_btn"),m=document.getElementById("fps"),h=document.getElementById("mainCanvas"),g=h.getContext("2d");let p=sessionStorage.getItem("fov")??50,w=h.width/p,u=sessionStorage.getItem("maxScore")??0,f=0,y=0,_=0,v=.4;const S=.5;let x=20;const I=75;let k,E=0;const T=200,b=40,L=35,M=40,A=10,R=new function(){this.position=new i,this.velocity=new i,this.score=0,this.onGround=!0,this.run_img_src=["img/char_0.png","img/char_1.png","img/char_2.png"],this.jump_img_src="img/char_j.png",this.dead_img_src="img/char_d.png"},j=[],C=[],B=[];let G=25,$=0,O=0,F=0,H=-1,N=!1;const D=new Image,P=new Image,W=new Image;function q(e=(new Date).getTime()){if(y==k+2)return g.drawImage(W,256,-10,512,256),s.down.pause(),s.down.currentTime=0,s.down.play(),t=R.score,void sessionStorage.setItem("maxScore",0==sessionStorage.length?t:Math.max(sessionStorage.getItem("maxScore"),t));var t;if(g.clearRect(0,0,h.width,h.height),z(),j.length<6&&(G+=K(x,I),j.push(new n(K(15,55),K(45,100),new i(G,0)))),C.length<10){$+=K(30,100);let e=K(0,50);C.push(new i($,30+e))}if(B.length<50){O+=K(5,20);let e=K(5,45);B.push(new o("w".repeat(K(1,5)),new i(O,T+e)))}!function(e){if(y=r.onAscFrame(),y==H)return;N=!1;for(let e=0;e<j.length;e++){let t=R.position.x,i=R.position.y,n=j[e].position.x,o=j[e].width,s=j[e].height,r=Math.abs(t-n),c=b/w;if(t>n&&(r=t-(n+o/w),c=0),r<c&&i+s>0){(0==c||Math.abs(t-n)<b/w/2)&&(R.dead_img_src="img/char_dh.png"),N=!0,v=0,E=a;break}}E==a?(k=k??y,D.src=R.dead_img_src):R.onGround?D.src=R.run_img_src[f]:(R.velocity.y+=S,R.position.y+=R.velocity.y,R.position.y>0&&(R.position.y=0,R.velocity.y=0,R.onGround=!0,D.src=R.run_img_src[f]));if(_+=v,R.position.x=_,H=y,y%5==0&&E!=a){let t=e-F;F=e,m.innerText=`[fps]: ${(1e3/(t/5)).toPrecision(5)}`,f=(f+1)%3}y%6==0&&E==c&&R.score++;R.score%100==0&&0!=R.score&&(s.speed.play(),v=Math.min(v+.01,1.05),x=Math.min(x+.5,50))}(e),requestAnimationFrame(q)}function z(){g.fillStyle="#a0d8ef",g.fillRect(0,0,h.width,T),g.fillStyle="#79c06e",g.fillRect(0,T,h.width,h.height),g.beginPath(),g.moveTo(0,T),g.lineTo(h.width,T),g.stroke();for(let e=0;e<C.length;e++){let t=w*(C[e].x-_)*.35,i=C[e].y;const n=new Image;n.src="img/cloud.png",g.drawImage(n,t,i,50,50),t<-50&&C.splice(e,1)}g.fillStyle="white",g.strokeStyle="black",g.lineWidth=3,g.shadowColor="#e83929",g.shadowBlur=20;for(let e=0;e<j.length;e++){let t=w*(j[e].position.x-_)+M,i=T;j[e].img?g.drawImage(j[e].img,t,i+A,j[e].width,-j[e].height):(g.fillRect(t,i+A,j[e].width,-j[e].height),g.strokeRect(t,i+A,j[e].width,-j[e].height)),t<-(j[e].width+10)&&j.splice(e,1)}g.shadowBlur=0,g.font="normal 22px monospace",g.fillStyle="black";for(let e=0;e<B.length;e++){let t=w*(B[e].position.x-_),i=B[e].position.y;K(1,5);g.fillText(B[e].str,t,i),t<-100&&B.splice(e,1)}g.drawImage(D,M,T+R.position.y-L+A+5,b,L),g.font="bold 22px monospace",g.strokeStyle="black",g.fillStyle="white",g.textAlign="right",g.lineWidth=1.5,g.fillText(`SCORE: ${R.score}`,h.width-100,30),g.strokeText(`SCORE: ${R.score}`,h.width-100,30),g.textAlign="left",g.fillText(`HI SCORE: ${u}`,50,30),g.strokeText(`HI SCORE: ${u}`,50,30)}function J(e){if(E==c&&("mousedown"==e.type||"Space"==e.code)){if(!R.onGround)return;s.jump.pause(),s.jump.currentTime=0,s.jump.play(),R.onGround=!1,D.src=R.jump_img_src,R.velocity.y=-12}}function K(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e)+e)}function Q(e){0==E&&("click"!=e.type&&"Space"!=e.code||(E=c,q()))}D.src=R.run_img_src[0],P.src="img/gamestart.png",W.src="img/gameover.png",l.addEventListener("input",(()=>{p=l.value,w=h.width/p,sessionStorage.setItem("fov",l.value)})),d.addEventListener("click",(()=>{u=0,sessionStorage.removeItem("maxScore")})),window.addEventListener("load",(()=>{let e=sessionStorage.getItem("fov")??50;l.value=e})),window.addEventListener("keydown",J),window.addEventListener("keydown",Q),h.addEventListener("mousedown",J),window.addEventListener("touchstart",J),h.addEventListener("click",Q),h.addEventListener("click",(function(e){if(E!=a)return;"click"!=e.type&&"Space"!=e.code||location.reload()})),P.addEventListener("load",(()=>{z(),0==E&&g.drawImage(P,256,-10,512,256)}));